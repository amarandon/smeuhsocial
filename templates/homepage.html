{% extends "site_base.html" %}

{% load i18n %}
{% load ifsetting_tag %}
{% load threadedcommentstags %}
{% load override_tags %}
{% load group_tags %}
{% load blog_tags %}

{% block head_title %}{% trans "Welcome" %}{% endblock %}

{% block body_class %}home{% endblock %}

{% block body %}
    
    {% if not user.is_authenticated %}
    <h1>{% trans 'This is your Smeuh' %}</h1>
    <div id="intro-text">
    {% blocktrans %}
    <p>This site is a platform for members and friends of <a
      href="http://smeuh.org/">Smeuh.org</a> to share pictures, sound and ideas.</p>
    <p>
      To know more about the code that runs this site, report bugs and maybe
      contribute, please check <a
        href="https://github.com/alex-marandon/smeuhsocial">the GitHub
        repository</a>.
    </p>
    {% endblocktrans %}
    </div>
    {% endif %}


      {% get_latest_comments 12 as latest_comments %}
      <div id="homepage-left-col">
        <h2>{% blocktrans %}Latest comments{% endblocktrans %}</h2>
        {% for comment in latest_comments %}
            {% if comment.content_object %}
            <div class="latest-comment-entry {% if forloop.last %}last{% endif %}">
              {% profile_link comment.user %} {% trans ' on ' %} <a href="{{ comment.content_object.get_absolute_url }}">{{ comment.content_object.title }}</a> <span class="comment-blurb-date">{% blocktrans with comment.date_modified|timesince as tweet_age %}{{ tweet_age }} ago{% endblocktrans %}</span>

              <div class="comment-blurb">{{ comment.comment|truncatewords:30|urlize|profilize }}</div>
            </div>
            {% endif %}
        {% endfor %}
      </div>

      <div id="homepage-right-col">
        <div class="latest-photos">
          <a title="Atom Feed" class="view-all feed-icon" href="{% url all_photos_feed %}"><img 
            src="{{ STATIC_URL }}img/feed-icon.png"/ ></a>
          <a class="view-all" href="{% url photos %}">{% blocktrans %}View all{% endblocktrans %}</a>
          <h2>{% blocktrans %}Latest photos{% endblocktrans %}</h2>
          {% for photo in latest_photos%}
          <a href="{% groupurl photo_details group id=photo.id %}"><img {% cycle '' ''  'class="row-end"' %}src="{{ photo.get_thumbnail_url }}" alt="{{ photo.title }}"/></a>
          {% endfor %}
        </div>
        <div class="latest-tweets">
          <a title="Atom Feed" class="view-all feed-icon" href="{% url all_tweets_feed %}"><img 
            src="{{ STATIC_URL }}img/feed-icon.png"/ ></a>
            <a class="view-all" href="{% url all_tweets %}">{% blocktrans %}View all{% endblocktrans %}</a>
          <h2>{% blocktrans %}Latest tweets{% endblocktrans %}</h2>
          {% for tweet in latest_tweets%}
              {% include "microblogging/_tweet.html" %}
          {% endfor %}
          {% if user.is_authenticated %}
          <form id="homepage-tweet-form" action="{% url tweets_you_follow %}" method="POST">
            {% csrf_token %}
            <input type="text" autocomplete="off" id="new_tweet" name="text" cols="30" rows="4"/>

            <input type="submit" value="{% trans 'Bang' %}">
            <span id="chars_left">140</span> caract√®res restant.
          </form>
          {% endif %}
        </div>
        <div class="latest-blogs">
            <a class="view-all" href="{% url blog_list_all %}">{% blocktrans %}View all{% endblocktrans %}</a>
          <h2>{% blocktrans %}Latest blog posts{% endblocktrans %}</h2>
          {% for blog_post in latest_blogs%}
          <a href="{{ blog_post.get_absolute_url }}">{{ blog_post.title }}</a> 
          by {% profile_link blog_post.author %}<br>
          {% endfor %}
        </div>
        <div class="latest-tracks">
            <a class="view-all" href="{% url audiotracks %}">{% blocktrans %}View all{% endblocktrans %}</a>
          <h2>{% blocktrans %}Latest tracks{% endblocktrans %}</h2>
          {% for track in latest_tracks%}
          <a href="{{ track.get_absolute_url }}">{{ track.title }}</a> 
          by {% profile_link track.user %}<br>
          {% endfor %}
        </div>
      </div>
    <div class="clear"></div>

    
    <hr />
    {% if user.is_authenticated %}
        {% url what_next as what_next_url %}
        <p class="what_next">{% blocktrans %}Wondering <a href="{{ what_next_url }}">What Next</a>?{% endblocktrans %}</p>
    {% else %}
        {% url acct_login as login_url %}
        {% ifsetting ACCOUNT_OPEN_SIGNUP %}
            {% url acct_signup as signup_url %}
            <p>{% blocktrans %}You can <a href="{{ signup_url }}">Sign up</a> and <a href="{{ login_url }}">Log in</a> to try out the site.{% endblocktrans %}</p>
        {% else %}
            <p>{% blocktrans %}You can <a href="{{ login_url }}">Log in</a> to try out the site.{% endblocktrans %}</p>
        {% endifsetting %}
    {% endif %}
    
{% endblock %}
{% block extra_body %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/microblogging.js"></script>
{% endblock %}
