{% load account_tags %}
{% load i18n %}
{% load override_tags %}
{% load avatar_tags %}
{% load cycle from future %}

<div class="timeline-item homepage-item {% if forloop.first %} first{% endif %}{% cycle ' odd' '' %} clearfix">

  <div class="clearfix {% if forloop.last %}last{% endif %}">
    
   {% with timelineitem.firstcomment as comment %}
   	<a href="{{ comment.content_object.get_absolute_url }}#comment_{{comment.id}}">{{ comment.content_object.title }}</a> {% trans 'has been commented' %} 
   {% endwith %}      
        
    	<div class="container-fluid">
    		<div class="row">
	    		<div class="col-xs-2">
	    		{% with timelineitem.firstcomment as comment %}	
				{% if comment.content_object.get_thumbnail_url %}
				{% with comment.content_object as photo %}				
				    <a href="{% url 'photo_details' id=photo.id %}#comment_{{comment.id}}">
				        <img class="img-rounded timeline-comment-thumb" src="{{ photo.get_thumbnail_url|urlencode }}" alt="{{ photo.title }}">
				    </a>
				{% endwith %}
				{% endif %}
				
				{% if comment.content_object.image.url_48x48 %}
				{% with comment.content_object as track %}
				<span style="margin: 3px;">
				    <a href="{% url 'track_detail' track.user.username track.slug %}#comment_{{comment.id}}">
				    {% if track.image %}
				    <img class="img-rounded" src="{{ track.image.url_48x48 }}" alt="{% trans 'Track Image' %}" style="max-height: 48px;"/>
				    {% else %}
				    {% avatar_link track.user 48 %}
				    {% endif %}
				    </a>
				</span>
				{% endwith %}
				{% endif %}
				{% endwith %}
	    		</div>
    		<div class="col-xs-10">
    			{% for commentitem in timelineitem.comments %}
				<div class="timeline-item homepage-item {% if forloop.first %} first{% endif %}{% cycle ' odd' '' %}  clearfix">
			
	  				 <div class="pull-right">
    					<span class="timesince">{% blocktrans with commentitem.date|timesince as item_age %}{{ item_age }} ago{% endblocktrans %}</span>
    				</div>
    				
    				{% avatar_link commentitem.user 24 %}
    				
    				<a href="{% url 'profile_detail' commentitem.user %}" id="tli_{{ timelineitem.index }}"><strong>{% user_display commentitem.user %}</strong></a>
    				
	  				{{ commentitem.item.comment|truncatewords:24|urlize|tagalize|smilize }}
    
				</div>  		    			
  				{% endfor %}
  			</div>    	
  		</div>
    			
    	</div>        		
  	
    </div>
  </div>         
